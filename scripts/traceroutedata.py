from ripe.atlas.sagan import Result
from ripe.atlas.sagan.traceroute import TracerouteResult, Hop, Packet
import json, sys, traceback
import geoip2.database

readerASN = geoip2.database.Reader('C:/Users/lsalie/Desktop/UCT/NIS/Assignment/GeoLite2-ASN_20190827/GeoLite2-ASN.mmdb')
readerCountry = geoip2.database.Reader('C:/Users/lsalie/Desktop/UCT/NIS/Assignment/GeoLite2-Country_20190827/GeoLite2-Country.mmdb')

def print_traceroute(rr):
	result = Result.get(rr)
	print(isinstance(result, TracerouteResult))
	print(result.af)
	print(result.destination_address)
	print(result.destination_name)
	print(result.end_time.isoformat())
	print(result.origin)
	print(result.firmware)
	print(result.measurement_id)
	print(result.probe_id)
	print(result.paris_id)
	print(result.protocol)
	print(result.total_hops)
	print(result.last_median_rtt)
	print(result.ip_path[3][1])
	print(result.hops[0].packets[0].destination_option_size)
	print(result.hops[0].packets[0].hop_by_hop_option_size)
	print(result.hops[0].packets[0].mtu)
	print(result.hops[3].index)
	print(result.hops[3].packets[0].origin)
	print(result.hops[3].packets[1].rtt)
	print(result.hops[3].packets[1].size)
	print(result.hops[3].packets[2].ttl)
	print(result.hops[-1].index)
	print("============================================================================")

print_traceroute({"af": 4, "dst_addr": "46.137.76.236", "dst_name": "46.137.76.236", "endtime": 1567491943, "from": "41.204.180.14", "fw": 4770, "group_id": 22730322, "lts": 108, "msm_id": 22730342, "msm_name": "Traceroute", "paris_id": 1, "prb_id": 33751, "proto": "ICMP", "result": [{"hop": 1, "result": [{"from": "41.204.180.13", "rtt": 43.971, "size": 28, "ttl": 255}, {"from": "41.204.180.13", "rtt": 1.585, "size": 28, "ttl": 255}, {"from": "41.204.180.13", "rtt": 0.521, "size": 28, "ttl": 255}]}, {"hop": 2, "result": [{"from": "41.204.173.37", "rtt": 5.428, "size": 28, "ttl": 254}, {"from": "41.204.173.37", "rtt": 5.419, "size": 28, "ttl": 254}, {"from": "41.204.173.37", "rtt": 5.337, "size": 28, "ttl": 254}]}, {"hop": 3, "result": [{"from": "197.136.168.18", "rtt": 5.503, "size": 28, "ttl": 253}, {"from": "197.136.168.18", "rtt": 5.5, "size": 28, "ttl": 253}, {"from": "197.136.168.18", "rtt": 5.409, "size": 28, "ttl": 253}]}, {"hop": 4, "result": [{"from": "196.32.209.117", "rtt": 166.424, "size": 28, "ttl": 251}, {"from": "196.32.209.117", "rtt": 167.138, "size": 28, "ttl": 251}, {"from": "196.32.209.117", "rtt": 166.508, "size": 28, "ttl": 251}]}, {"hop": 5, "result": [{"from": "196.32.210.178", "rtt": 166.567, "size": 28, "ttl": 250}, {"from": "196.32.210.178", "rtt": 166.365, "size": 28, "ttl": 250}, {"from": "196.32.210.178", "rtt": 166.334, "size": 28, "ttl": 250}]}, {"hop": 6, "result": [{"from": "80.249.210.217", "rtt": 166.968, "size": 28, "ttl": 249}, {"from": "80.249.210.217", "rtt": 168.253, "size": 28, "ttl": 249}, {"from": "80.249.210.217", "rtt": 166.901, "size": 28, "ttl": 249}]}, {"hop": 7, "result": [{"from": "54.239.114.96", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 308608, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 168.205, "size": 140, "ttl": 245}, {"from": "54.239.114.96", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 308608, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 222.749, "size": 140, "ttl": 245}, {"from": "54.239.114.96", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 308608, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 177.614, "size": 140, "ttl": 245}]}, {"hop": 8, "result": [{"from": "54.239.114.105", "ittl": 2, "rtt": 167.905, "size": 28, "ttl": 246}, {"from": "54.239.114.105", "ittl": 2, "rtt": 167.018, "size": 28, "ttl": 246}, {"from": "54.239.114.105", "ittl": 2, "rtt": 167.512, "size": 28, "ttl": 246}]}, {"hop": 9, "result": [{"from": "54.239.43.16", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 185182, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 178.102, "size": 140, "ttl": 241}, {"from": "54.239.43.16", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 185182, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 178.093, "size": 140, "ttl": 241}, {"from": "54.239.43.16", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 185182, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 178.046, "size": 140, "ttl": 241}]}, {"hop": 10, "result": [{"from": "54.239.44.142", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 532299, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 178.277, "size": 140, "ttl": 242}, {"from": "54.239.44.142", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 532299, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 177.904, "size": 140, "ttl": 242}, {"from": "54.239.44.142", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 532299, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 178.706, "size": 140, "ttl": 242}]}, {"hop": 11, "result": [{"x": "*"}, {"x": "*"}, {"x": "*"}]}, {"hop": 12, "result": [{"from": "52.93.6.156", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 355520, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 177.723, "size": 140, "ttl": 240}, {"from": "52.93.6.156", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 355520, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 177.849, "size": 140, "ttl": 240}, {"from": "52.93.6.156", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 355520, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 177.639, "size": 140, "ttl": 240}]}, {"hop": 13, "result": [{"from": "52.93.101.49", "rtt": 176.93, "size": 28, "ttl": 242}, {"from": "52.93.101.49", "rtt": 185.028, "size": 28, "ttl": 242}, {"from": "52.93.101.49", "rtt": 176.868, "size": 28, "ttl": 242}]}, {"hop": 14, "result": [{"from": "52.93.101.0", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 5384, "s": 0, "ttl": 1}, {"exp": 0, "label": 51, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 178.973, "size": 144, "ttl": 236}, {"from": "52.93.101.0", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 5384, "s": 0, "ttl": 1}, {"exp": 0, "label": 51, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 178.325, "size": 144, "ttl": 236}, {"from": "52.93.101.0", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 5384, "s": 0, "ttl": 1}, {"exp": 0, "label": 51, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 178.156, "size": 144, "ttl": 236}]}, {"hop": 15, "result": [{"from": "52.93.7.65", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 51, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 180.256, "size": 140, "ttl": 238}, {"from": "52.93.7.65", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 51, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 180.019, "size": 140, "ttl": 238}, {"from": "52.93.7.65", "icmpext": {"obj": [{"class": 1, "mpls": [{"exp": 0, "label": 51, "s": 1, "ttl": 1}], "type": 1}], "rfc4884": 0, "version": 2}, "rtt": 177.664, "size": 140, "ttl": 238}]}, {"hop": 16, "result": [{"x": "*"}, {"x": "*"}, {"x": "*"}]}, {"hop": 17, "result": [{"x": "*"}, {"x": "*"}, {"x": "*"}]}, {"hop": 18, "result": [{"x": "*"}, {"x": "*"}, {"x": "*"}]}, {"hop": 19, "result": [{"x": "*"}, {"x": "*"}, {"x": "*"}]}, {"hop": 20, "result": [{"x": "*"}, {"x": "*"}, {"x": "*"}]}, {"hop": 255, "result": [{"from": "46.137.76.236", "rtt": 176.93, "size": 48, "ttl": 44}, {"from": "46.137.76.236", "rtt": 176.929, "size": 48, "ttl": 44}, {"from": "46.137.76.236", "rtt": 176.879, "size": 48, "ttl": 44}]}], "size": 48, "src_addr": "41.204.180.14", "stored_timestamp": 1567491956, "timestamp": 1567491864, "type": "traceroute"})

